#!/bin/sh
npm install
export PATH="node_modules/.bin:node_modules/hubot/node_modules/.bin:$PATH"

FID=${PWD##*/}

case $1 in
start)
  forever start \
    --uid "$FID" \
    --minUptime 10000 --spinSleepTime 600000 \
    -o hubot.log -a \
    -w --watchDirectory scripts/ \
    -c coffee node_modules/.bin/hubot -a direct "$@"
  ;;
stop|restart)
  forever $1 "$FID"
  ;;
status)
  forever list | grep "] $FID "
  ;;
logs)
  tail -f hubot.log
  ;;
*)
  exec node_modules/.bin/hubot -a direct "$@"
  ;;
esac

